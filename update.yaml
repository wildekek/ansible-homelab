- name: Update base system
  hosts: all:!status_stopped:!Windows:!homeassistant:!media
  become: true
  pre_tasks:
    - name: "Update repository cache"
      ansible.builtin.package:
        update_cache: true
      changed_when: false
  tasks:
    - name: "Update packages"
      ansible.builtin.package:
        update_cache: false
        upgrade: true
    - name: "Check if reboot required"
      ansible.builtin.stat:
        path: /var/run/reboot-required
      register: reboot_required

- name: Update docker containers
  hosts: role_docker
  become: false
  tasks:
    - name: "Pull and start containers"
      community.docker.docker_compose_v2:
        project_src: ./docker
        pull: always
