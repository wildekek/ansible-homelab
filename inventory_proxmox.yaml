plugin: community.proxmox.proxmox
url: https://proxmox1.home.willem.vooijs.eu:8006
validate_certs: false
user: ansible@pve
token_id: ansible
token_secret: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          35643763663638323066353939393265366131333030363438383435343163616239653233303636
          3461346162623763373466653736643564613065383865660a346461343238393362323239333735
          63306131363865613765313537353465383630303566653738653764373738646131356463393364
          6364306161373239370a306461316262616333633934313435643666333930666637653339303839
          37366135356137393663643330623535663136636662353730363066666266316366383532336435
          6231366264326533656433613732653438363239313237383235

# Enable to gather VM/LXC configuration facts
want_facts: true

# Compose dynamic host variables
compose:
  # Use the first IP address found in network configuration
  ansible_host: proxmox_ipconfig0.ip | default(proxmox_net0.ip) | ipaddr('address')
  # Override remote user for specific VMs
  ansible_user: |
    {%- if inventory_hostname == 'homeassistant' -%}
    root
    {%- else -%}
    willem
    {%- endif -%}

# Group VMs by their status and roles
keyed_groups:
  - key: proxmox_status
    prefix: status
  - key: proxmox_type
    prefix: type
  - key: proxmox_node
    prefix: node
  # Group by individual tags (roles)
  - key: proxmox_tags_parsed | default([])
    prefix: role
    separator: "_"

# Show all VMs/containers (remove status filter)
# filters:
#   - proxmox_status == "running"